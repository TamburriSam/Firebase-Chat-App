(()=>{const e=firebase.auth(),o=firebase.firestore(),t=document.getElementById("signup-form"),n=document.getElementById("log-out"),l=document.querySelector("#user"),s=document.querySelector("#signin-form"),i=document.querySelector(".rooms"),r=document.querySelector("#rooms"),a=document.querySelectorAll(".logged-out"),c=document.querySelector(".logged-in"),d=e=>{if(e){const o=`Hello ${e.email}`;l.innerHTML=o,c.style.display="block",a.forEach((e=>{e.style.display="none"}))}else l.innerHTML="",c.style.display="none",a.forEach((e=>{e.style.display="block"}))};t.addEventListener("submit",(n=>{n.preventDefault();const s=t["signup-email"].value,i=t["signup-password"].value;e.createUserWithEmailAndPassword(s,i).then((e=>o.collection("users").doc(e.user.uid).set({name:e.user.email,list_one:[],list_two:[],list_three:[],list_four:[]}).then((()=>{l.innerHTML=`Hello ${e.user.email}`,t.reset(),r.style.display="block"}))))})),n.addEventListener("click",(function(o){o.preventDefault(),e.signOut().then((()=>{console.log("user signed out")})),l.innerHTML="Signed Out",r.style.display="none"})),s.addEventListener("submit",(o=>{o.preventDefault();const t=s["signin-email"].value,n=s["signin-password"].value;e.signInWithEmailAndPassword(t,n).then((e=>{l.innerHTML="Hello "+e.user.email,s.reset(),r.style.display="block"}))})),e.onAuthStateChanged((e=>{console.log(e),e?(r.style.display="block",o.collection("rooms").onSnapshot((e=>{u(e.docs)})),d(e)):(u([]),d())}));const u=e=>{if(e.length){let o="";e.forEach((e=>{const t=e.data();console.log(e.id);const n=`<li><button data-id="btn" class="room-select" id="${e.id}">${t.Name}</button>${t.Count} Students</li>`;o+=n})),i.innerHTML=o}else i.innerHTML="<h5>Log in to view rooms</h5>"},m=document.querySelector("#create-room");m.addEventListener("submit",(e=>{e.preventDefault(),o.collection("rooms").add({Name:m["room-name"].value,Count:m["room-count"].value,active_count:0}).then((()=>{m.reset()})).catch((e=>{console.error(e)}))}));let g=0;document.body.addEventListener("click",(function(e){if("btn"==e.target.dataset.id){let t=e.target.innerHTML;console.log(t),o.collection("rooms").onSnapshot((e=>{e.forEach((e=>{if(e.data().Name===t){if(e.data().active_count<e.data().Count)return console.log(!0),console.log(e),console.log(e.data().Name),console.log(e.id),o.collection("rooms").doc(e.id).update({Count:g+=1});console.log(!1)}}))}))}}))})();